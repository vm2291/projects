D2L=D2L||{};D2L.LP=D2L.LP||{};D2L.LP.AppLoader={};D2L.LP.AppLoader.Apps={};D2L.LP.AppLoader.Apps.Controls={};D2L.LP.AppLoader.Apps.Controls.HtmlApp={Init:function(node){var htmlApp=D2L.LP.AppLoader.Apps.Controls.HtmlApp;var $node=$(node);var appUrl=$node.data('appUrl');if(!appUrl){htmlApp.HandleError();return;}var loadingDelay=$node.data('loadingDelay');if(!loadingDelay){loadingDelay=1000;}$node.data('isLoading',true);setTimeout(function(){$node.toggleClass('d2l-htmlapp-loading',$node.data('isLoading'));},loadingDelay);$.ajaxSetup({cache:true});$node.load(appUrl,function(response,status,xhr){$.ajaxSetup({cache:null});$node.data('isLoading',false);if(status=='error'){htmlApp.HandleError(appUrl);return;}$node.removeClass('d2l-htmlapp-loading');$(document).trigger('D2L.HtmlApp.Ready');});},HandleError:function(appUrl){D2L.Tools.Logger.Error('Error loading Html Application with Uri: '+appUrl,function(){window.location.href='/d2l/error/404';});},IsLoading:function(node){if(!node){return false;}return $(node).data('isLoading');}};D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-htmlapp',function(node){D2L.LP.AppLoader.Apps.Controls.HtmlApp.Init(node);});D2L.LP.AppLoader.Umd={GetAppPath:function(endpoint){return{getLocation:function(){return endpoint.substr(0,endpoint.lastIndexOf('/')+1);}};},Init:function(appId,placeholderId,endpoint,orgUnit,locale,appOptions,showLoading,onLoad){require.config({waitSeconds:0});if(showLoading){var loadSpinner=function(){var container=document.querySelector('.umd_spinner_container');if(container){container.style.display='block';}};setTimeout(loadSpinner,500);}appOptions['appPath']=D2L.LP.AppLoader.Umd.GetAppPath(endpoint).getLocation();appOptions['orgUnit']=orgUnit;if(!require.specified('d2l-orgunit')&&!require.specified('d2l-locale')&&!require.specified('d2l-app-path-provider')){define('d2l-orgunit',orgUnit);define('d2l-locale',locale);define('d2l-app-path-provider',D2L.LP.AppLoader.Umd.GetAppPath(endpoint));require(['d2l-orgunit','d2l-locale']);}require([endpoint],function(install){var hideSpinner;if(showLoading){hideSpinner=function(){var container=document.querySelector('.umd_spinner_container');if(container){container.parentElement.removeChild(container);}};}if(!install){showLoading&&hideSpinner();throw'Unable to load application, ensure it is a valid UMD module';}var teardown=new Promise(function(resolve,reject){D2L.LP.Web.UI.Html.PartialRendering.OnBefore.AddListener(function(id){if(D2L.LP.Web.UI.Html.Dom.IsAncestor(document.getElementById(id.GetValue()),document.getElementById(placeholderId))){D2L.LP.Web.UI.Html.PartialRendering.OnBefore.RemoveListener(this);resolve();}});});install(document.getElementById(placeholderId),appOptions,hideSpinner,teardown);if(onLoad){onLoad();}});}};D2L.LP.AppLoader.IFrame={MessageListenerMap:new Map(),Util:{Noop:function(){},NormalizeUrl:function normalizeUrl(url){var index=url.indexOf('/d2l/');if(index>-1){url=url.substr(index);}return url;},Spread:function spread(fn){return function spreadFnWrapper(arr){return fn.apply(this,arr);};}},Plugins:{StateChange:function(host){function statechangeHandler(){var state=History.getState();var url=D2L.LP.AppLoader.IFrame.Util.NormalizeUrl(state.url);host.sendEvent('navigation.statechange',url);}function anchorchangeHandler(){host.sendEvent('navigation.anchorchange',document.location.pathname);}function popstateHandler(){var state=History.getState();var url=D2L.LP.AppLoader.IFrame.Util.NormalizeUrl(state.url);host.sendEvent('navigation.popstate',url);}History.Adapter.bind(window,'statechange',statechangeHandler);History.Adapter.bind(window,'onanchorchange',anchorchangeHandler);window.addEventListener('popstate',popstateHandler);}},Services:{Navigation:function(getIframe){return{get:function(){return D2L.LP.AppLoader.IFrame.Util.NormalizeUrl(document.location.href);},getLastD2LPage:function(){return D2L.LP.Web.UI.Html.LastPage.Get();},pop:function(){History.back();},push:function(url,title){title=title||document.title;History.pushState(null,title,url);},replace:function(url,title){title=title||document.title;History.replaceState(null,title,url);},go:function(url){document.location.href=url;},reload:function(){document.location.reload();},scrollTo:function(id){document.getElementById(id).scrollIntoView();},setScrollTopRelativeToIframe:function(scrollTop){var iframe=getIframe();if(!iframe){return;}var position=iframe.getBoundingClientRect().top+window.pageYOffset;document.documentElement.scrollTop=position+scrollTop;document.body.scrollTop=position+scrollTop;}};},ReturnPoints:{get:function(key,defaultLocation){if(defaultLocation!==undefined){defaultLocation=new D2L.LP.Web.Http.UrlLocation(defaultLocation);}const valueLocation=D2L.LP.Web.UI.Html.ReturnPoints.Get(key,defaultLocation);return valueLocation.GetUrl();},set:function(key,location){if(location!==undefined){location=new D2L.LP.Web.Http.UrlLocation(location);}D2L.LP.Web.UI.Html.ReturnPoints.Set(key,location);}},FlashMessageService:{show:function(message,autoHide){if(!message){console.warn('No message text provided to Flash Message Service');return;}var location=new D2L.LP.Web.Http.UrlLocation('/d2l/lp/apploader/iframe/flashMessageService');var isD2LWindow=function(wnd){return wnd.D2L!==undefined&&wnd.D2L.LP!==undefined&&wnd.D2L.LP.Web!==undefined&&wnd.D2L.LP.Web.UI!==undefined;};var win=window;var lastSeenD2LWin;if(isD2LWindow(win)){lastSeenD2LWin=win;}while(win!==win.parent&&D2L.LP.Web.UI.Html.Dom.HasSafeParent(win)){win=win.parent;if(isD2LWindow(win)){lastSeenD2LWin=win;}}if(lastSeenD2LWin){lastSeenD2LWin.D2L.LP.Web.UI.Rpc.Connect(D2L.LP.Web.UI.Rpc.Verbs.POST,location,{'message':message,'autoHide':autoHide!==false});}}},DialogService:function(getFrame,getIFrame){return D2L.LP.AppLoader.DialogService(getFrame,getIFrame);},DialogWCService:function(getIFrame){return D2L.LP.AppLoader.DialogWCService(getIFrame);},ConvertToViewableHtmlService:function(orgUnitId){return{filterHtml:function(html,filterMode){return new Promise(function(resolve,reject){var params={filterMode:filterMode||'Strict',html:html};var options={success:resolve,failure:reject};D2L.LP.Web.UI.Rpc.Connect(D2L.LP.Web.UI.Rpc.Verbs.POST,new D2L.LP.Web.Http.UrlLocation('/d2l/lp/htmleditor/converttoabsolute').WithQueryString('ou',orgUnitId),params,options);});}};},ImmersiveService:function(getFrame){return{makeImmersive:function(fullPage){D2L.LP.Web.UI.Desktop.MasterPages.Immersive.MakeImmersive(getFrame());if(fullPage){document.body.classList.add('immersive-full-page-open');}},removeImmersive:function(){D2L.LP.Web.UI.Desktop.MasterPages.Immersive.RemoveImmersive(getFrame());document.body.classList.remove('immersive-full-page-open');}};},PickerService:function(dialogService){return{open:function(orgUnitId,settings){return D2L.LP.AppLoader.Picker.Open(dialogService,orgUnitId,settings);},getSources:function(){return D2L.LP.AppLoader.Picker.GetSources();},pickUsingCim:function(returnUrl,cimJson){return D2L.LP.AppLoader.Picker.PickUsingCim(returnUrl,cimJson);}};},SessionService:function(logoutLocation){return{logout:function(){D2L.PT.Auth.Logout(logoutLocation);}};}},Init:function(id,endpoint,orgUnit,valenceHost,options,height,frameId,onLoad,customPlugins,logoutLocation){function getFrame(){return document.getElementById(id);}function getIFrame(){var frame=getFrame();if(frame){var iframes=frame.getElementsByTagName('iframe');return iframes.length>0?iframes[0]:null;}return null;}if(!D2L.LP.AppLoader.IFrame.MessageListenerMap.has(id)){function handleIsFramedRequest(evt){if(!evt||evt.data!=='isFramedRequest')return;var iframe=getIFrame();if(iframe.contentWindow!==evt.source)return;if(!/^(?:http|https):\/\//.test(evt.origin))return;var originHost=new URL(evt.origin).hostname;var endpointWithProtocol=/^(?:http|https):\/\//.test(endpoint)?endpoint:window.location.protocol+endpoint;var endpointHost=new URL(endpointWithProtocol).hostname;if(originHost!==endpointHost)return;evt.source.postMessage({isFramed:true},evt.origin);window.removeEventListener('message',handleIsFramedRequest,false);D2L.LP.AppLoader.IFrame.MessageListenerMap.delete(id);}D2L.LP.AppLoader.IFrame.MessageListenerMap.set(id,handleIsFramedRequest);window.addEventListener('message',handleIsFramedRequest,false);}var p=new Promise(function(resolve){var initialPlugins=[frauJwthost,D2L.LP.AppLoader.IFrame.Plugins.StateChange];if(window.ifrauhost){resolve([ifrauhost,initialPlugins]);return;}var interval=setInterval(function(){if(!window.ifrauhost)return;clearInterval(interval);resolve([ifrauhost,initialPlugins]);return;},50);});p.then(D2L.LP.AppLoader.IFrame.Util.Spread(function(Host,plugins){var host=new Host(getFrame,endpoint,{syncFont:true,syncLang:true,syncPageTitle:true,height:height,id:frameId,allowFullScreen:true,syncCssVariable:true,allowMicrophone:true,allowCamera:true,allowScreenCapture:true,allowEncryptedMedia:true,allowAutoplay:true,allowClipboard:true});var i;for(i=0,n=plugins.length;i<n;++i){host=host.use(plugins[i]);}for(i=0,n=customPlugins?customPlugins.length:0;i<n;++i){host=host.use(customPlugins[i]);}return host.onRequest('orgUnit',orgUnit).onRequest('valenceHost',valenceHost).onRequest('options',options).onRequest('appPath',function(){return endpoint.substr(0,endpoint.lastIndexOf('/')+1);}).onEvent('userIsActive',function(){D2L.LP.Web.UI.Events.OnFraUserEvent.Trigger();}).registerService('navigation','0.1',D2L.LP.AppLoader.IFrame.Services.Navigation(getIFrame)).registerService('return-points','0.1',D2L.LP.AppLoader.IFrame.Services.ReturnPoints).registerService('frame','0.1',{close:function(){var frame=getFrame();if(frame){frame.parentElement.removeChild(frame);}},sizeToViewport:function(enableScroll){var iframe=getIFrame();if(iframe){if(enableScroll){iframe.scrolling="yes";}iframe.style.display='block';iframe.style.height='100vh';iframe.style.width='100vw';iframe.style.overflow='auto';document.body.style.overflow='hidden';}},sizeToFillBody:function(){var iframe=getIFrame();if(iframe){var headerSize=0;var header=document.getElementsByTagName('header')[0];if(header){headerSize=header.clientHeight;}iframe.style.height='calc( 100vh - '+headerSize+'px )';iframe.style.width='100%';document.body.style.overflow='hidden';}},applyStyle:function(style){var iframe=getIFrame();Object.keys(style).forEach(function(rule){iframe.style[rule]=style[rule];});},setUpParent:function(styles,attributes){var iframe=getIFrame();if(iframe){var parentFrame=iframe.contentWindow.parent.frameElement;if(parentFrame){Object.keys(styles).forEach(function(rule){parentFrame.style[rule]=styles[rule];});Object.keys(attributes).forEach(function(attribute){parentFrame[attribute]=attributes[attribute];});parentFrame.style.height=iframe.style.height;}}},resizeParent:function(){var iframe=getIFrame();if(iframe){var parentFrame=iframe.contentWindow.parent.frameElement;if(parentFrame){parentFrame.style.height=iframe.style.height;}}}}).registerService('flashMessage','0.1',D2L.LP.AppLoader.IFrame.Services.FlashMessageService).registerService('dialog','0.1',D2L.LP.AppLoader.IFrame.Services.DialogService(getFrame,getIFrame)).registerService('convert-to-viewable-html','0.1',D2L.LP.AppLoader.IFrame.Services.ConvertToViewableHtmlService(orgUnit.OrgUnitId)).registerService('immersive','0.1',D2L.LP.AppLoader.IFrame.Services.ImmersiveService(getFrame)).registerService('picker','0.1',D2L.LP.AppLoader.IFrame.Services.PickerService(D2L.LP.AppLoader.IFrame.Services.DialogService(getFrame,getIFrame))).registerService('session','0.1',D2L.LP.AppLoader.IFrame.Services.SessionService(logoutLocation)).connect();})).then(()=>D2L.WebComponentsReady).then(function(host){getFrame().d2lHost=host;const iframe=getIFrame();const endpointWithProtocol=/^(?:http|https):\/\//.test(endpoint)?endpoint:window.location.protocol+endpoint;const endpointOrigin=new URL(endpointWithProtocol).origin;D2L.ContextProvider.allowFrame(iframe,endpointOrigin);if(onLoad){onLoad(D2L.LP.Web.UI.Html.AbsoluteHtmlId.Create(frameId),host);}D2L.LP.AppLoader.IFrame.Services.DialogService.TriggerAbortEvent=function(){D2L.LP.AppLoader.IFrame.Services.DialogService(getFrame,getIFrame).triggerAbort(host);};});}};D2L.LP.Web.UI.Html.Dom.AddClassDestructor('d2l-fra-iframe',function(node){var messageListener=D2L.LP.AppLoader.IFrame.MessageListenerMap.get(node.id);if(messageListener){window.removeEventListener('message',messageListener,false);D2L.LP.AppLoader.IFrame.MessageListenerMap.delete(node.id);}if(node.d2lHost){node.d2lHost.close();node.d2lHost=undefined;}});D2L.LP.AppLoader.DialogService=function(getFrame,getIFrame){function setupFrame(){var frame=getIFrame();var frameId=frame.id;var openerId;if(frameId){openerId=new D2L.LP.Web.UI.Html.AbsoluteHtmlId.Create(frameId);}else{openerId=new D2L.LP.Web.UI.Html.UniqueHtmlId();frame.id=openerId.GetValue();}return openerId;}function openDialog(location,settings){var openerId=setupFrame();return new Promise(function(resolve,reject){var openEvent=D2L.LP.Web.UI.Desktop.MasterPages.Dialog.Open(openerId,location,settings);openEvent.AddListener(function(result){resolve(result);});openEvent.AddReleaseListener(function(){reject();});});}function openLegacyDialog(location,settings,buttons,srcCallback,responseDataKey){var urlLocation={GetUrl:function(){return location;}};var openerId=setupFrame();return new Promise(function(resolve,reject){var openEvent=D2L.LP.Web.UI.Legacy.MasterPages.Dialog.Open(openerId,urlLocation,srcCallback||'','',responseDataKey||'',settings.PreferredSize.PreferredWidth,settings.PreferredSize.PreferredHeight,settings.closeButtonText,buttons||[],false,null,settings.byPassOpenerFocus||false);openEvent.AddListener(function(result){resolve(result);});openEvent.AddReleaseListener(function(){reject();});});}function toIconClass(iconType){switch(iconType){case'alert':return'd2l-dialog-inline-body-alert';case'warning':return'd2l-dialog-inline-body-warning';default:return null;}}return{abort:function(){D2L.LP.Web.UI.Desktop.MasterPages.Dialog.Abort();},open:function(location,settings){var urlLocation=new D2L.LP.Web.Http.UrlLocation(location);return openDialog(urlLocation,settings);},openConfirm:function(settings){return new Promise(function(resolve,reject){D2L.LP.Web.UI.Desktop.MasterPages.Dialog.Inline.Open(settings.title,settings.primaryMessage,settings.secondaryMessage,settings.positiveButtonText,settings.negativeButtonText,typeof settings.closeButtonText=='undefined'?"Close this Dialog":settings.closeButtonText,toIconClass(settings.iconType),resolve,function(){reject("negativeButtonPressed");},function(){reject("abortButtonPressed");},getIFrame(),null,typeof settings.equalButtonWidths=='undefined'?true:settings.equalButtonWidths);});},openExternal:function(title,location,settings,height,width){var queryParams={"location":location,"title":title};if(height){queryParams["height"]=height;}if(width){queryParams["width"]=width;}var urlLocation=D2L.LP.Web.Http.UrlLocation.Create("/d2l/lp/apploader/iframe/dialogService/open",queryParams);return openDialog(urlLocation,settings);},openWithParam:function(location,params,settings){var urlLocation=new D2L.LP.Web.Http.UrlLocation(location);var openerId=setupFrame();return new Promise(function(resolve,reject){var openWithParamEvent=D2L.LP.Web.UI.Desktop.MasterPages.Dialog.OpenWithParam(openerId,urlLocation,params,settings);openWithParamEvent.AddListener(function(result){resolve(result);});openWithParamEvent.AddReleaseListener(function(){reject();});});},openLegacy:function(location,settings,buttons,srcCallback,responseDataKey){return openLegacyDialog(location,settings,buttons,srcCallback,responseDataKey);},openLegacyConfirm:function(location,settings,srcCallback,responseDataKey){var buttons=[{Text:settings.positiveButtonText,ResponseType:1,Param:null,Key:'BTN_BadgeDialogPrimary',IsPrimary:true,IsEnabled:true},{Text:settings.negativeButtonText,ResponseType:2,IsPrimary:false,IsEnabled:true}];return openLegacyDialog(location,settings,buttons,srcCallback,responseDataKey);},close:function(result){D2L.LP.Web.UI.Desktop.MasterPages.Dialog.Close(result);},triggerAbort:function(host){host.sendEvent('d2l.dialog.abort');},setButtonText:function(id,text){var handle=D2L.LP.Web.UI.Desktop.MasterPages.Dialog.GetHandle(window);var button=D2L.LP.Web.UI.Html.Dom.GetElementById(id);if(button){button.innerText=text;}},setButtonVisible:function(id,visible){var button=D2L.LP.Web.UI.Html.Dom.GetElementById(id);if(button){var fun=visible?D2L.LP.Web.UI.Html.Dom.RemoveClassName:D2L.LP.Web.UI.Html.Dom.AddClassName;fun('d2l-hidden',button);}},setButtonEnabled:function(id,enabled){var button=D2L.LP.Web.UI.Html.Dom.GetElementById(id);if(button){D2L.LP.Web.UI.Desktop.Controls.Button.SetIsEnabledNode(button,enabled);}},setSize:function(width,height,ignoreDefaultMinSize){var handle=D2L.LP.Web.UI.Desktop.MasterPages.Dialog.GetHandle(window);D2L.LP.Web.UI.Desktop.MasterPages.Dialog.SetSize(handle,width,height,ignoreDefaultMinSize);},setDialogHeading:function(title){D2L.LP.Web.UI.Desktop.MasterPages.Dialog.SetHeading(title);},buttonClickOnce:function(id){var button=D2L.LP.Web.UI.Html.Dom.GetElementById(id);if(button){return new Promise(function(resolve){var buttonClone=button.cloneNode(true);button.parentNode.replaceChild(buttonClone,button);var listener=function(){var isEnabled=D2L.LP.Web.UI.Desktop.Controls.Button.IsEnabledNode(buttonClone);if(isEnabled){D2L.LP.Web.UI.Html.Dom.RemoveEventListener('click',buttonClone,listener);resolve();}};D2L.LP.Web.UI.Html.Dom.AddEventListener('click',buttonClone,listener);});}else{return Promise.reject('Button #'+id+' does not exist');}},fitToDialogBody:function(){function fit(iframe,handle){var dialogBodyHeight=handle.body.clientHeight;handle.body.style.overflow='hidden';iframe.style.height=dialogBodyHeight+'px';}var dialog=D2L.LP.Web.UI.Desktop.MasterPages.Dialog;var handle=dialog.GetHandle();var iframe=getIFrame();if(handle.body&&iframe){var fitFrame=fit.bind(undefined,iframe,handle);window.addEventListener('resize',fitFrame);fitFrame();}}};};D2L.LP.AppLoader.Picker={GetSources:function(){return{announcement:"news",assignment:"dropbox",calendar:"schedule",checklist:"checklist",content:"content",courseFile:"coursefile",discussion:"discuss",ePortfolio:"epobject",formTemplate:"form",googleDrive:'google-drive',lti:"lti",oneDrive:'one-drive',oneDriveLti:'one-drive-lti',quiz:"quiz",selfAssessment:"selfassess",survey:"survey",url:"url"};},GetSourcesToLangtermMap:function(){var sources=this.GetSources();var sourcesToLangtermMap={};sourcesToLangtermMap[sources.googleDrive]='Pickers.Quicklinks.titleAddMaterials';sourcesToLangtermMap[sources.assignment]='Pickers.Quicklinks.titleAssignmentDialog';sourcesToLangtermMap[sources.quiz]='Pickers.Quicklinks.titleQuizDialog';sourcesToLangtermMap[sources.discussion]='Pickers.Quicklinks.titleDiscussionDialog';sourcesToLangtermMap[sources.oneDrive]='Pickers.Quicklinks.titleAddMaterials';sourcesToLangtermMap[sources.oneDriveLti]='Pickers.Quicklinks.titleAddMaterials';sourcesToLangtermMap[sources.lti]='Pickers.Quicklinks.titleLtiDialog';sourcesToLangtermMap[sources.checklist]='Pickers.Quicklinks.titleChecklistDialog';return sourcesToLangtermMap;},Open:function(dialogService,orgUnitId,settings){if(!orgUnitId){return Promise.reject(new Error("Picker Service: must specify orgUnitId"));}var sources=this.GetSources();var sourcesToLangtermMap=this.GetSourcesToLangtermMap();settings=settings||{};settings.source=typeof settings.source==="undefined"?"":settings.source;settings.canChangeSource=typeof settings.canChangeSource==="undefined"?true:settings.canChangeSource;settings.showCancelButton=typeof settings.showCancelButton==="undefined"?false:settings.showCancelButton;settings.dialogTitle=typeof settings.dialogTitle==="undefined"?"":settings.dialogTitle;settings.pickOnly=typeof settings.pickOnly==="undefined"?false:settings.pickOnly;settings.contextId=typeof settings.contextId==="undefined"?"":settings.contextId;if(Array.isArray(settings.allowedTypes)){settings.allowedTypes=settings.allowedTypes.join(",");}else if(settings.allowedTypes!=null){settings.allowedTypes=String(settings.allowedTypes);}var dialogTitleLangTerm=sourcesToLangtermMap[settings.source];var outputFormat=typeof settings.urlSettings==="undefined"||typeof settings.urlSettings.requireTitleAndTarget==="undefined"||!settings.urlSettings.requireTitleAndTarget?"":"html";var urlShowTarget=typeof settings.urlSettings==="undefined"||typeof settings.urlSettings.showTarget==="undefined"?true:settings.urlSettings.showTarget;var urlShowCancelButtonInline=typeof settings.urlSettings!=="undefined"&&typeof settings.urlSettings.showCancelButtonInline!=="undefined"?settings.urlSettings.showCancelButtonInline:false;if(!settings.source&&!settings.canChangeSource){return Promise.reject(new Error("Picker Service: must provide source when canChangeSource=false"));}if(settings.source&&settings.source!==sources.url&&settings.urlSettings&&settings.urlSettings.requireTitleAndTarget){return Promise.reject(new Error("Picker Service: requireTitleAndTarget=true is only applicable to url source"));}if(settings.mode!=null){settings.mode=String(settings.mode);}if(settings.initialViewType==null){if(!settings.canChangeSource||settings.source.length>0){if(settings.mode==="CreateOnly"||settings.mode==="2"){settings.initialViewType="Add";}else{settings.initialViewType="Items";}}else{settings.initialViewType="Default";}}return this.m_openHelper(sources,dialogService,orgUnitId,settings.source,settings.canChangeSource,settings.dialogTitle,settings.showCancelButton,outputFormat,urlShowTarget,urlShowCancelButtonInline,settings.initialViewType,dialogTitleLangTerm,settings.pickOnly,settings.mode,settings.parentModuleId,settings.contextId,settings.allowedTypes,settings.itemId);},m_openHelper:function(sources,dialogService,orgUnitId,source,canChangeSource,dialogTitle,showCancelButton,outputFormat,urlShowTarget,urlShowCancelButtonInline,initialViewType,dialogTitleLangTerm,pickOnly,mode,parentModuleId,contextId,allowedTypes,itemId){var dialogUrl="/d2l/lp/quicklinks/manage/"+orgUnitId+"/CreateDialog?typeKey="+encodeURIComponent(source)+"&canChangeType="+canChangeSource+"&customTitle="+encodeURIComponent(dialogTitle)+"&contextId="+encodeURIComponent(contextId)+"&showCancelButton="+showCancelButton+"&outputFormat="+outputFormat+"&urlShowTarget="+urlShowTarget+"&urlShowCancelButtonInline="+urlShowCancelButtonInline+"&selectedText=";if(parentModuleId){dialogUrl=dialogUrl+"&parentModuleId="+parentModuleId;}if(dialogTitleLangTerm){dialogUrl=dialogUrl+"&customTitleLangTerm="+dialogTitleLangTerm;}if(initialViewType!=null){dialogUrl+="&initialViewType="+encodeURIComponent(initialViewType);}if(pickOnly){dialogUrl+="&pickOnly="+encodeURIComponent(pickOnly);}if(mode!=null){dialogUrl+="&mode="+encodeURIComponent(mode);}if(allowedTypes){dialogUrl+="&allowedTypes="+encodeURIComponent(allowedTypes);}if(itemId){dialogUrl+="&itemId="+encodeURIComponent(itemId);}var dialogPromise=dialogService.open(dialogUrl,{});return dialogPromise.then(function(dialogResponse){if(dialogResponse){var item={name:dialogResponse.m_title,source:source,type:dialogResponse.m_typeKey,properties:dialogResponse.m_properties};var response={items:[item]};var actualTypeKey=dialogResponse.m_typeKey;if(dialogResponse.m_url&&dialogResponse.m_url.length>0&&!Object.keys(sources).some(function(src){return sources[src]===actualTypeKey;})){if(/^(http|https|ftp):\/\//i.test(dialogResponse.m_url)){actualTypeKey=sources.url;}else{var quickLinkTemplate=decodeURIComponent(dialogResponse.m_url);item.quickLinkTemplate=quickLinkTemplate;var quickLink=quickLinkTemplate.replace(/\{orgUnitId\}/gi,orgUnitId);item.quickLink=quickLink;item.activityId=null;item.toolItemId=null;item.url=dialogResponse.m_url;var aLink={};aLink['rel']=aLink['class']=null;aLink['title']=dialogResponse.m_title;aLink['type']='text/html';aLink['href']=quickLink;item.links=[aLink];return Promise.resolve(response);}}if(actualTypeKey===sources.url){item.activityId=null;item.toolItemId=null;item.quickLinkTemplate=null;item.quickLink=null;item.url=dialogResponse.m_url;var aLink={};aLink['rel']=aLink['class']=null;aLink['title']=dialogResponse.m_title;aLink['type']='text/html';aLink['href']=dialogResponse.m_url;item.links=[aLink];return Promise.resolve(response);}var globalId=dialogResponse.m_id;var quickLinkUrl="/d2l/api/lp/unstable/"+orgUnitId+"/quickLinks/"+actualTypeKey+"/"+globalId;return new Promise(function(resolve,reject){var req=new XMLHttpRequest();req.addEventListener("load",function(){if(req.status!==200){reject(new Error("Picker Service: HTTP error.  Details: "+req.responseText));}else{var jsonResponse=JSON.parse(req.response);item.quickLink=jsonResponse.QuickLink;item.quickLinkTemplate=jsonResponse.QuickLinkTemplate;item.url=jsonResponse.Url;item.toolItemId=jsonResponse.ToolItemId;item.activityId=jsonResponse.ActivityId;item.links=(jsonResponse.Links||[]).map(function(link){var result={};result['class']=link['Class'];result['rel']=link['Rel'];result['title']=link['Title'];result['href']=link['Href'];result['type']=link['Type'];return result;});resolve(response);}});req.open("GET",quickLinkUrl);req.send();});}return Promise.resolve(null);});},PickUsingCim:function(returnUrl,cimJson){var appendJsonParamsToForm=function(form,json){var keys=Object.keys(json);for(var i=0;i<keys.length;i++){var key=keys[i];var value=json[key];var inputElement=document.createElement('input');inputElement.setAttribute('type','hidden');inputElement.setAttribute('name',key);inputElement.setAttribute('value',value);form.appendChild(inputElement);}};var cimBody={'lti_message_type':'ContentItemSelection','lti_version':'LTI-1p0','content_items':cimJson};var form=document.createElement('form');form.setAttribute('method','post');form.setAttribute('action',returnUrl);appendJsonParamsToForm(form,cimBody);document.body.appendChild(form);form.submit();}};